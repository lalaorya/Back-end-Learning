# seckill

![image-20210518220004524](C:%5CDocuments(%E8%B5%84%E6%96%99)%5CLearning%5C%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E5%B0%8F%E6%B2%88%5Cimg%5Cimage-20210518220004524.png)

## 秒杀的特点

- 定时开始，大量用于同一时间争抢购买同一个商品

- 库存有限，下单数量远远大于库存数量

- 大量的并发读（读取剩余库存）和并发写（下单成功库存-1）

- 下订单减库存

  > “减库存”设计的核心逻辑有三种：
  >
  > - 下订单减库存
  > - 付款再减库存
  > - 预扣库存方案
  >
  > 因为秒杀一般下完订单都会付款，而且有机制防止恶意购买。因此秒杀减库存一般是下订单减库存

## 秒杀系统整体架构要求及解决方案

- 高性能：即使用户量十分巨大，我们也要保证响应速度
  - 数据的动态分离
  - 热点数据的发现和隔离
  - 请求的削峰与分层过滤
- 一致性：库存的一致性，防止超卖
- 高可用：秒杀时会在一瞬间涌入大量的流量，为了避免系统宕机，保证高可用，需要做好流量限制
  - 集群
  - 兜底方案

由于秒杀场景的特殊，为了不影响现有业务的正常运行，我们一般把秒杀系统和其他系统做隔离，也就是秒杀系统是一个单独的服务。它有单独的数据库/数据表，静态页面也是单独部署的。

## 秒杀流程分析

![](C:%5CDocuments(%E8%B5%84%E6%96%99)%5CLearning%5C%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E5%B0%8F%E6%B2%88%5Cimg%5CEdH5MzyG6wtmF8g.png)

**秒杀其实就是针对库存设计的一个系统**

- 用户秒杀，库存-1
  - 超时已付款，库存不会滚
  - 超时未付款，库存回滚
- 避免重复秒杀

![](C:%5CDocuments(%E8%B5%84%E6%96%99)%5CLearning%5C%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E5%B0%8F%E6%B2%88%5Cimg%5CQbdLT6xIBHyiRcF.png)

> tips:
>
> - 先实现基本功能，在优化

