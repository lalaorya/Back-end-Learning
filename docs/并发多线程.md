### MuliThread Note

> å¤šçº¿ç¨‹é¢è¯•é¢˜ç›®ï¼š
>
> <img src="https://i.loli.net/2021/03/30/NP1DVyjv3b6rLCY.png" alt="image-20210328224614193" style="zoom: 150%;" />

#### 1. è¿›ç¨‹å’Œçº¿ç¨‹çš„åŸºç¡€

1. ğŸ‘¨â€âš–ï¸ï¼šä¸ºä»€ä¹ˆè¦æœ‰è¿›ç¨‹ï¼Ÿ

   ğŸ™‹â€â™‚ï¸ï¼šåˆšå¼€å§‹çš„è®¡ç®—æœºç³»ç»Ÿ**å†…å­˜ä¸­å§‹ç»ˆåªæœ‰ä¸€ä¸ªç¨‹åºåœ¨è¿è¡Œ**ï¼Œåé¢çš„ç¨‹åºéœ€è¦ç­‰å¾…å‰é¢çš„ç¨‹åºæ‰§è¡Œå®Œæˆåæ‰èƒ½å¼€å§‹æ‰§è¡Œï¼Œè€Œå‰é¢çš„ç¨‹åºæœ‰æ—¶ä¼šç”±äºI/Oæ“ä½œã€ç½‘ç»œç­‰åŸå› é˜»å¡ï¼Œæ‰€ä»¥**æ•ˆç‡ä¸é«˜**ã€‚å› æ­¤æå‡ºäº†è¿›ç¨‹ï¼Œè¿›ç¨‹å°±æ˜¯**åº”ç”¨ç¨‹åºåœ¨å†…å­˜ä¸­åˆ†é…çš„ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯==æ­£åœ¨è¿è¡Œçš„ç¨‹åº==**ï¼Œå„ä¸ªè¿›ç¨‹ä¹‹é—´äº’ä¸å¹²æ‰°ã€‚åŒæ—¶è¿›ç¨‹ä¿å­˜ç€ç¨‹åºæ¯ä¸€ä¸ªæ—¶åˆ»è¿è¡Œçš„çŠ¶æ€ã€‚

   åŒæ—¶ï¼ŒCPUé‡‡å–**æ—¶é—´ç‰‡è½®è½¬**çš„æ–¹å¼è¿è¡Œè¿›ç¨‹ï¼šCPUä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…ä¸€ä¸ªæ—¶é—´æ®µï¼Œç§°ä½œå®ƒçš„æ—¶é—´ç‰‡ã€‚å¦‚æœåœ¨æ—¶é—´ç‰‡ç»“æŸæ—¶è¿›ç¨‹è¿˜åœ¨è¿è¡Œï¼Œåˆ™æš‚åœè¿™ä¸ªè¿›ç¨‹çš„è¿è¡Œï¼Œå¹¶ä¸”CPUåˆ†é…ç»™å¦ä¸€ä¸ªè¿›ç¨‹ï¼ˆè¿™ä¸ªè¿‡ç¨‹å«åšä¸Šä¸‹æ–‡åˆ‡æ¢ï¼‰ã€‚å¦‚æœè¿›ç¨‹åœ¨æ—¶é—´ç‰‡ç»“æŸå‰é˜»å¡æˆ–ç»“æŸï¼Œåˆ™CPUç«‹å³è¿›è¡Œåˆ‡æ¢ï¼Œä¸ç”¨ç­‰å¾…æ—¶é—´ç‰‡ç”¨å®Œã€‚

   å› æ­¤ï¼Œ==æ—¶é—´ç‰‡è½®è½¬ + è¿›ç¨‹ ---> å¹¶å‘==ï¼Œå› ä¸ºæœ‰äº†å¹¶å‘ï¼Œæˆ‘ä»¬å¯ä»¥åŒæ—¶æ‰§è¡Œå¤šä¸ªç¨‹åºã€‚

> æ‹“å±•çŸ¥è¯†ï¼šåœ¨Javaä¸­ï¼Œå½“æˆ‘ä»¬å¯åŠ¨mainå‡½æ•°æ—¶å…¶å®å°±å¯åŠ¨äº†ä¸€ä¸ªJVMçš„è¿›ç¨‹ï¼Œè€Œmainå‡½æ•°æ‰€åœ¨çš„çº¿ç¨‹å°±æ˜¯è¿™ä¸ªè¿›ç¨‹ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿç§°ä¸»çº¿ç¨‹ã€‚ç¨‹åºå®é™…è¿è¡Œæ˜¯ä¾èµ–çº¿ç¨‹çš„ï¼Œcpuä¹Ÿæ˜¯åˆ†é…ç»™çº¿ç¨‹çš„ã€‚
>
> ==è¿›ç¨‹å’Œçº¿ç¨‹å†…å­˜å…³ç³»å›¾==
>
> <img src="https://i.loli.net/2021/04/15/yKrgeYGw8FOP3v1.png" alt="image-20210330235942725" style="zoom:67%;" />
>
> ä¸€ä¸ªè¿›ç¨‹ä¸­æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œå¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹çš„å †å’Œæ–¹æ³•åŒºèµ„æºï¼Œä½†æ˜¯æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨å’Œæ ˆåŒºåŸŸ ( å­˜å‚¨å±€éƒ¨å˜é‡å’Œçº¿ç¨‹çš„è°ƒç”¨æ ˆå¸§ï¼‰ã€‚
>
> ğŸ‘¨â€âš–ï¸ï¼šä»€ä¹ˆæ˜¯ç¨‹åºè®¡æ•°å™¨ï¼Ÿ
>
> ğŸ™‹â€â™‚ï¸ï¼šç¨‹åºè®¡æ•°å™¨å°±æ˜¯ä¸ºäº†è®°å½•è¯¥çº¿ç¨‹è®©å‡ºCPUæ—¶çš„æ‰§è¡Œåœ°å€çš„ï¼Œå¾…å†æ¬¡åˆ†é…åˆ°æ—¶é—´ç‰‡æ—¶çº¿ç¨‹å°±å¯ä»¥ä»è‡ªå·±**ç§æœ‰**çš„è®¡æ•°å™¨æŒ‡å®šåœ°å€ç»§ç»­æ‰§è¡Œã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ‰§è¡Œçš„æ˜¯nativeæ–¹æ³•ï¼Œé‚£ä¹ˆpcè®¡æ•°å™¨è®°å½•çš„æ˜¯undefinedåœ°å€ï¼Œåªæœ‰æ‰§è¡Œçš„æ˜¯Javaä»£ç æ—¶pcè®¡æ•°å™¨è®°å½•çš„æ‰æ˜¯ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚

----

2. ğŸ‘¨â€âš–ï¸ï¼šä¸ºä»€ä¹ˆæœ‰äº†è¿›ç¨‹è¿˜éœ€è¦çº¿ç¨‹ï¼Ÿ

   ğŸ™‹â€â™‚ï¸ï¼š**ä¸ºäº†å®ç°è¿›ç¨‹å†…éƒ¨çš„å¹¶å‘ã€‚**å¦‚æœä¸€ä¸ªè¿›ç¨‹æœ‰å¤šä¸ªå­ä»»åŠ¡æ—¶ï¼Œåªèƒ½é€ä¸ªå¾—æ‰§è¡Œè¿™äº›å­ä»»åŠ¡ï¼Œå¾ˆå½±å“æ•ˆç‡ã€‚è®©ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä¸€ä¸ªå­ä»»åŠ¡ï¼Œè¿™æ ·ä¸€ä¸ªè¿›ç¨‹å°±åŒ…å«äº†å¤šä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹è´Ÿè´£ä¸€ä¸ªå•ç‹¬çš„å­ä»»åŠ¡ã€‚**è¿›ç¨‹çš„å†…éƒ¨å¹¶å‘å¯ä»¥è®©å¤šä¸ªå­ä»»åŠ¡åŒæ—¶æ‰§è¡Œï¼Œæ•ˆç‡æ›´é«˜**ã€‚

   ---

3. ğŸ‘¨â€âš–ï¸ï¼šè¿›ç¨‹å†…éƒ¨ä½¿ç”¨å­è¿›ç¨‹ä¹Ÿå¯ä»¥å®ç°å¹¶å‘ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ä½¿ç”¨çº¿ç¨‹ï¼Ÿ

   ğŸ™‹â€â™‚ï¸ï¼šâ‘  è¿›ç¨‹é—´çš„é€šä¿¡æ¯”è¾ƒå¤æ‚ï¼Œè€Œçº¿ç¨‹é—´çš„é€šä¿¡æ¯”è¾ƒç®€å•ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å…±äº«èµ„æºï¼Œè¿™äº›èµ„æºåœ¨çº¿ç¨‹é—´çš„é€šä¿¡æ¯”è¾ƒå®¹æ˜“ã€‚â‘¡ è¿›ç¨‹æ˜¯é‡é‡çº§çš„ï¼Œè€Œçº¿ç¨‹æ˜¯è½»é‡çº§çš„ï¼Œæ•…å¤šçº¿ç¨‹æ–¹å¼çš„ç³»ç»Ÿå¼€é”€æ›´å°ã€‚

   > è¿›ç¨‹é—´é€šä¿¡çš„æ–¹å¼
   >
   > - ç®¡é“ï¼šä¸€ç«¯è¾“å…¥ï¼Œä¸€ç«¯è¯»å–ï¼Œå› æ­¤å®ç°é€šä¿¡éœ€è¦ä¸¤æ ¹ç®¡é“
   > - æ¶ˆæ¯é˜Ÿåˆ—
   > - å…±äº«å†…å­˜
   > - ä¿¡å·é‡ï¼šä¸€æ®µç”¨äºæ§åˆ¶è¿›ç¨‹çš„äº’æ–¥å’ŒåŒæ­¥ï¼Œä¸ä¼ è¾“é€šä¿¡æ•°æ®
   > - Socketç½‘ç»œç¼–ç¨‹

   ---

4. ğŸ‘¨â€âš–ï¸ï¼šè¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«

   ğŸ™‹â€â™‚ï¸ï¼šè¿›ç¨‹æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿è¡Œç¯å¢ƒï¼Œè€Œçº¿ç¨‹æ˜¯åœ¨è¿›ç¨‹ä¸­æ‰§è¡Œçš„ä¸€ä¸ªä»»åŠ¡ã€‚ä»–ä»¬ä¸¤ä¸ªæœ¬è´¨çš„åŒºåˆ«æ˜¯**æ˜¯å¦å•ç‹¬å æœ‰å†…å­˜åœ°å€ç©ºé—´åŠå…¶å®ƒç³»ç»Ÿèµ„æºï¼ˆæ¯”å¦‚I/Oï¼‰ï¼š**

   - è¿›ç¨‹å•ç‹¬å æœ‰ä¸€å®šçš„å†…å­˜åœ°å€ç©ºé—´ï¼Œæ‰€ä»¥è¿›ç¨‹é—´å­˜åœ¨å†…å­˜éš”ç¦»ï¼Œæ•°æ®æ˜¯åˆ†å¼€çš„ï¼Œæ•°æ®å…±äº«å¤æ‚ä½†æ˜¯åŒæ­¥ç®€å•ï¼Œå„ä¸ªè¿›ç¨‹ä¹‹é—´äº’ä¸å¹²æ‰°ï¼›è€Œçº¿ç¨‹å…±äº«æ‰€å±è¿›ç¨‹å æœ‰çš„å†…å­˜åœ°å€ç©ºé—´å’Œèµ„æºï¼Œæ•°æ®å…±äº«ç®€å•ï¼Œä½†æ˜¯åŒæ­¥å¤æ‚ã€‚

   - è¿›ç¨‹å•ç‹¬å æœ‰ä¸€å®šçš„å†…å­˜åœ°å€ç©ºé—´ï¼Œä¸€ä¸ªè¿›ç¨‹å‡ºç°é—®é¢˜ä¸ä¼šå½±å“å…¶ä»–è¿›ç¨‹ï¼Œä¸å½±å“ä¸»ç¨‹åºçš„ç¨³å®šæ€§ï¼Œå¯é æ€§é«˜ï¼›ä¸€ä¸ªçº¿ç¨‹å´©æºƒå¯èƒ½å½±å“æ•´ä¸ªç¨‹åºçš„ç¨³å®šæ€§ï¼Œå¯é æ€§è¾ƒä½ã€‚

   - è¿›ç¨‹å•ç‹¬å æœ‰ä¸€å®šçš„å†…å­˜åœ°å€ç©ºé—´ï¼Œè¿›ç¨‹çš„åˆ›å»ºå’Œé”€æ¯ä¸ä»…éœ€è¦ä¿å­˜å¯„å­˜å™¨å’Œæ ˆä¿¡æ¯ï¼Œè¿˜éœ€è¦èµ„æºçš„åˆ†é…å›æ”¶ä»¥åŠé¡µè°ƒåº¦ï¼Œå¼€é”€è¾ƒå¤§ï¼›çº¿ç¨‹åªéœ€è¦ä¿å­˜å¯„å­˜å™¨å’Œæ ˆä¿¡æ¯ï¼Œå¼€é”€è¾ƒå°ã€‚

   å¦å¤–ä¸€ä¸ªé‡è¦åŒºåˆ«æ˜¯ï¼Œ**è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ï¼Œè€Œçº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œè°ƒåº¦çš„åŸºæœ¬å•ä½**ï¼Œå³CPUåˆ†é…æ—¶é—´çš„å•ä½ ã€‚

   ---

5. ğŸ‘¨â€âš–ï¸ï¼šä½¿ç”¨å¤šçº¿ç¨‹ä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜ï¼Ÿ

   ğŸ™‹â€â™‚ï¸ï¼šâ‘  å®‰å…¨æ€§é—®é¢˜ã€‚å› ä¸ºçº¿ç¨‹ä¹‹é—´å…±äº«è¿›ç¨‹çš„å†…å­˜ç©ºé—´ï¼Œå½“å®ƒä»¬åŒæ—¶æ“ä½œæŸä¸€å†…å­˜ç©ºé—´æ—¶ï¼Œå¯èƒ½ä¼šäº§ç”Ÿæ„æƒ³ä¸åˆ°çš„ç»“æœï¼Œä¹Ÿå°±æ˜¯æ•°æ®ä¸åŒæ­¥çš„é—®é¢˜ã€‚æ‰€ä»¥æˆ‘ä»¬è¦ä½¿ç”¨é”æœºåˆ¶æ¥å¯¹èµ„æºè¿›è¡Œæ§åˆ¶ï¼Œå®ç°æ•°æ®åŒæ­¥ã€‚â‘¡ æ­»é”é—®é¢˜ã€‚â‘¢ æ€§èƒ½é—®é¢˜ã€‚çº¿ç¨‹ä¹‹é—´é¢‘ç¹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ä¼šå¸¦æ¥æå¤§çš„å¼€é”€ã€‚

   ----

6. ğŸ‘¨â€âš–ï¸ï¼šåˆ›å»ºçº¿ç¨‹çš„ä¸‰ç§æ–¹å¼æ˜¯ä»€ä¹ˆï¼Ÿ

   ğŸ™‹â€â™‚ï¸ï¼šç»§æ‰¿Threadæ–¹å¼åˆ›å»ºçš„å¥½å¤„æ˜¯ä¼ å‚æ–¹ä¾¿ï¼Œä½†æ˜¯Javaæ— æ³•å¤šç»§æ‰¿ã€‚

   â€‹		  å®ç°Runnbleæ–¹å¼åˆ›å»ºçš„å¥½å¤„æ˜¯å¯ä»¥ç»§æ‰¿å…¶ä»–ç±»ï¼Œä½†æ˜¯ä¼ å‚éº»çƒ¦ï¼Œåªèƒ½ä½¿ç”¨ä¸»çº¿ç¨‹çš„finalå˜é‡

   â€‹		  å®ç°Callableæ–¹å¼åˆ›å»ºçš„å¥½å¤„æ˜¯æœ‰è¿”å›å€¼

   ```java
   public class _01_CreateThread {
       // åˆ›å»ºçº¿ç¨‹æœ‰ä¸‰ç§æ–¹å¼
       // â‘  ç»§æ‰¿Threadç±»
       public static class MyThread extends Thread{
           @Override
           public void run() {
               System.out.println("Thread1");
           }
       }
   
       // â‘¡ å®ç°Runnableæ¥å£
       // Runnableæ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£
       public static class MyThread2 implements Runnable{
   
           public void run() {
               System.out.println("Thread2");
           }
       }
       
       // â‘¢ å®ç°callableæ¥å£
       public static class MyThread3 implements Callable<String>{
   
           public String call() throws Exception {
               return "Thread3";
           }
       }
   
       public static void main(String[] args) {
           MyThread myThread = new MyThread();
           myThread.start();
   
           MyThread2 myThread2 = new MyThread2();
           new Thread(myThread2).start();
   
           FutureTask<String> myThread3 = new FutureTask<String>(new MyThread3());
           new Thread(myThread3).start();
           String result = null;
           try {
               result = myThread3.get();
               System.out.println(result);
           } catch (InterruptedException e) {
               e.printStackTrace();
           } catch (ExecutionException e) {
                e.printStackTrace();
           }
       }
   }
   
   ```

   ----

7. ğŸ‘¨â€âš–ï¸ï¼šä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Ÿ

   ğŸ™‹â€â™‚ï¸ï¼šå¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ä¸€èˆ¬çº¿ç¨‹çš„ä¸ªæ•°éƒ½å¤§äº CPU æ ¸å¿ƒçš„ä¸ªæ•°ï¼Œè€Œä¸€ä¸ª CPU æ ¸å¿ƒåœ¨ä»»æ„æ—¶åˆ»åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œä¸ºäº†è®©è¿™äº›çº¿ç¨‹éƒ½èƒ½å¾—åˆ°æœ‰æ•ˆæ‰§è¡Œï¼ŒCPU é‡‡å–çš„ç­–ç•¥æ˜¯ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…æ—¶é—´ç‰‡å¹¶è½®è½¬çš„å½¢å¼ã€‚å½“ä¸€ä¸ªçº¿ç¨‹çš„æ—¶é—´ç‰‡ç”¨å®Œçš„æ—¶å€™å°±ä¼šé‡æ–°å¤„äºå°±ç»ªçŠ¶æ€è®©ç»™å…¶ä»–çº¿ç¨‹ä½¿ç”¨ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å±äºä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚**ä¸Šä¸‹æ–‡åˆ‡æ¢å…¶å®å°±æ˜¯ä¸€ä¸ªçº¿ç¨‹ä»ä¿å­˜(æ—¶é—´ç‰‡ç”¨å®Œ)åˆ°å†åŠ è½½(é‡æ–°åˆ†é…åˆ°CPU)çš„è¿‡ç¨‹ã€‚**å…·ä½“å®ç°æ˜¯é€šè¿‡çº¿ç¨‹ç§æœ‰çš„PCæ¢å¤ç°åœºç¯å¢ƒã€‚

   ---

8. ğŸ‘¨â€âš–ï¸ï¼šè®²ä¸€ä¸‹Javaçº¿ç¨‹çš„çŠ¶æ€å’Œè½¬åŒ–æ–¹æ³•

   ğŸ™‹â€â™‚ï¸

   > æ™®é€šçº¿ç¨‹çš„çŠ¶æ€å’Œè½¬æ¢ï¼š
   >
   > <img src="https://i.loli.net/2021/04/27/aypCqt2IcXxuDi7.png" alt="img" style="zoom:200%;" />
   >
   > Javaçº¿ç¨‹çš„çŠ¶æ€å’Œè½¬æ¢ï¼š
   >
   > ```java
   > // Thread.State æºç 
   > // Javaçº¿ç¨‹çš„6ä¸ªçŠ¶æ€
   > public enum State {
   > NEW,
   > RUNNABLE,
   > BLOCKED,
   > WAITING,
   > TIMED_WAITING,
   > TERMINATED;
   > }
   > ```
   >
   > NEWï¼šnewå®Œä¸€ä¸ªè¿›ç¨‹å¤„äºNEWçŠ¶æ€(å‡†å¤‡çŠ¶æ€)
   >
   > â€‹													$\Downarrow$è°ƒç”¨startæ–¹æ³•
   >
   > *READYï¼š å°±ç»ªçŠ¶æ€ï¼Œçº¿ç¨‹æ­£åœ¨ç­‰å¾…è°ƒåº¦*
   >
   > â€‹							$\Uparrow$æ—¶é—´ç‰‡ç”¨å®Œ						$\Downarrow$è·å¾—CPUæ—¶é—´ç‰‡
   >
   > *RUNNINGï¼šè¿è¡ŒçŠ¶æ€*
   >
   > RUNNABLE(READY+RUNNING)ï¼šè¡¨ç¤ºçº¿ç¨‹åœ¨è™šæ‹Ÿæœºä¸­è¿è¡Œï¼Œä¹Ÿå¯èƒ½åœ¨ç­‰å¾…ç³»ç»Ÿèµ„æº
   >
   > â€‹													$\Downarrow$ ç­‰å¾…é”çš„é‡Šæ”¾
   >
   > BLOCKEDï¼šé˜»å¡çŠ¶æ€ï¼Œç­‰å¾…èµ„æºçš„é‡Šæ”¾ã€‚è·å¾—èµ„æºåè¿›è¡ŒREADYçŠ¶æ€
   >
   > WAITINGï¼šè°ƒç”¨ä»¥ä¸‹æ–¹æ³•ä¼šä½¿çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚ç­‰å¾…çŠ¶æ€ä¸‹çš„çº¿ç¨‹éœ€è¦å…¶ä»–çº¿ç¨‹å”¤é†’æ‰èƒ½è¿›å…¥RUNNABLE
   >
   > - Object.wait()ï¼šä½¿å½“å‰çº¿ç¨‹å¤„äºç­‰å¾…çŠ¶æ€ç›´åˆ°å¦ä¸€ä¸ªçº¿ç¨‹å”¤é†’å®ƒï¼›
   >
   > - Thread.join()ï¼šç­‰å¾…çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œåº•å±‚è°ƒç”¨çš„æ˜¯Objectå®ä¾‹çš„waitæ–¹æ³•ï¼›
   >
   > - LockSupport.park()ï¼šé™¤éè·å¾—è°ƒç”¨è®¸å¯ï¼Œå¦åˆ™ç¦ç”¨å½“å‰çº¿ç¨‹è¿›è¡Œçº¿ç¨‹è°ƒåº¦ã€‚
   >
   > TIMED_WAITINGï¼šè¶…æ—¶ç­‰å¾…çŠ¶æ€ï¼Œæ—¶é—´åˆ°äº†è‡ªåŠ¨å”¤é†’
   >
   > - Thread.sleep(long millis)ï¼šä½¿å½“å‰çº¿ç¨‹ç¡çœ æŒ‡å®šæ—¶é—´ï¼›
   >
   > - Object.wait(long timeout)ï¼šçº¿ç¨‹ä¼‘çœ æŒ‡å®šæ—¶é—´ï¼Œç­‰å¾…æœŸé—´å¯ä»¥é€šè¿‡notify()/notifyAll()å”¤é†’ï¼›
   >
   > - Thread.join(long millis)ï¼šç­‰å¾…å½“å‰çº¿ç¨‹æœ€å¤šæ‰§è¡Œmillisæ¯«ç§’ï¼Œå¦‚æœmillisä¸º0ï¼Œåˆ™ä¼šä¸€ç›´æ‰§è¡Œï¼›
   >
   > - LockSupport.parkNanos(long nanos)ï¼š é™¤éè·å¾—è°ƒç”¨è®¸å¯ï¼Œå¦åˆ™ç¦ç”¨å½“å‰çº¿ç¨‹è¿›è¡Œçº¿ç¨‹è°ƒåº¦æŒ‡å®šæ—¶é—´ï¼›
   >
   > - LockSupport.parkUntil(long deadline)ï¼šåŒä¸Šï¼Œä¹Ÿæ˜¯ç¦æ­¢çº¿ç¨‹è¿›è¡Œè°ƒåº¦æŒ‡å®šæ—¶é—´ï¼›
   >
   > TERMINATEDï¼šç»ˆæ­¢çŠ¶æ€
   
   ---

9. waitå’Œsleepçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

   - waitæ˜¯Objectç±»çš„æ–¹æ³•ï¼Œå¿…é¡»åœ¨synchronizedå—é‡Œé¢ï¼Œå› æ­¤å‰ææ˜¯è·å¾—Objectçš„é”ï¼Œä¼šä¼‘çœ æ‰€æœ‰æŠ¢å äº†objecté”çš„çº¿ç¨‹ï¼Œå¹¶ä¸”éœ€è¦notifyå”¤é†’ã€‚sleepæ˜¯Threadçš„æ–¹æ³•ï¼Œå®ƒåœ¨ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨ï¼Œä¼šä¼‘çœ å½“å‰çº¿ç¨‹ï¼Œåˆ°æ—¶ä¼šè‡ªåŠ¨å”¤é†’
   - waitä¸€èˆ¬ç”¨äºçº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ï¼Œsleepåªæ˜¯å•çº¯è®©çº¿ç¨‹ä¼‘çœ 
   - waitä¼šé‡Šæ”¾å½“å‰çº¿ç¨‹æŒæœ‰çš„é”ï¼Œè€Œsleepä¸ä¼š
   
10. ğŸ‘¨â€âš–ï¸ï¼šJavaçº¿ç¨‹ä¹‹é—´å¦‚ä½•è¿›è¡Œé€šä¿¡ï¼Ÿ

   ğŸ™‹â€â™‚ï¸ï¼šJavaçº¿ç¨‹é€šä¿¡ä¸»è¦æœ‰å››ç§æ–¹å¼

   - é”åŒæ­¥æœºåˆ¶
   - ç­‰å¾…é€šçŸ¥æœºåˆ¶(waitå’Œnotify)
   - ä¿¡å·é‡(valatileå…³é”®å­—)
   - ç®¡é“æœºåˆ¶

   ---

11. ğŸ‘¨â€âš–ï¸ï¼šçº¿ç¨‹å®‰å…¨çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆå®ç°ï¼Ÿ

    ğŸ™‹â€â™‚ï¸ï¼š[æµ…è°ˆsynchronizedå’Œvolatitleå®ç°çº¿ç¨‹å®‰å…¨çš„ç­–ç•¥](https://jsdi.top/article/65)

    ---

12. ğŸ‘¨â€âš–ï¸ï¼šè¯´è¯´è‡ªå·±æ˜¯æ€ä¹ˆä½¿ç”¨synchronizedå…³é”®å­—çš„

    ğŸ™‹â€â™‚ï¸ï¼šæ‚²è§‚é”ï¼Œå¯ä»¥ç”¨åœ¨é™æ€æ–¹æ³•ã€æ™®é€šæ–¹æ³•æˆ–è€…ä»£ç å—ä¸Šã€‚

    ---

13. ğŸ‘¨â€âš–ï¸ï¼šä¸ºä»€ä¹ˆsynchronizedèƒ½å¤Ÿå®ç°çº¿ç¨‹åŒæ­¥ï¼Ÿ

    ğŸ™‹â€â™‚ï¸ï¼šJavaå¯¹è±¡å¤´+Monitor

    ---

14. ğŸ‘¨â€âš–ï¸ï¼šCASæ˜¯ä»€ä¹ˆï¼ŸJavaä¸­å¦‚ä½•å®ç°CASï¼Ÿ

    ğŸ™‹â€â™‚ï¸ï¼šCASï¼ˆCompare and Swapï¼‰,å…ˆæ¯”è¾ƒå†äº¤æ¢ï¼Œæ˜¯å®ç°åŸå­æ€§æ“ä½œçš„ä¸€ç§æ€æƒ³ã€‚åœ¨Javaä¸­ï¼Œsynchronizedèƒ½ä¿è¯å†…å­˜å¯è§å’ŒåŸå­æ€§ï¼Œä½†æ˜¯synchronizedæ˜¯é˜»å¡å¼çš„ï¼Œä¼šå¯¼è‡´çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¼€é”€è¾ƒå¤§ã€‚è€Œvolatileåªèƒ½ä¿è¯å†…å­˜å¯è§æ€§ï¼Œä¸èƒ½ä¿è¯åŸå­æ€§ï¼Œä¸ºäº†ä¼˜åŒ–è¿™äº›é—®é¢˜ï¼Œå°±å‡ºç°äº†CASã€‚

    CASæ˜¯JDKæä¾›çš„éé˜»å¡åŸå­æ€§æ“ä½œï¼Œé€šè¿‡ç¡¬ä»¶ä¿è¯æ“ä½œçš„åŸå­æ€§ã€‚**å®ç°æ€è·¯æ˜¯å…ˆæ¯”è¾ƒå½“å‰å€¼å’Œæ—§å€¼æ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒè¯´æ˜è¿™æ­¤æœŸé—´æ²¡æœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹è¿‡æ­¤å˜é‡ï¼Œå°†æ–°å€¼èµ‹å€¼ç»™å½“å‰å€¼ã€‚å¦‚æœä¸åŒè¯´æ˜å‡ºç°äº†çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¤±è´¥çš„çº¿ç¨‹ä¸ä¼šè¢«é˜»å¡ï¼Œè€Œæ˜¯è¢«å‘ŠçŸ¥æ­¤æ¬¡ç«äº‰å¤±è´¥äº†ï¼Œå¹¶å¯ä»¥å†æ¬¡å°è¯•ã€‚**

    Javaå®ç°CASçš„åŸç†æ˜¯é€šè¿‡Unsafeç±»

    `boolean compareAndSwapObject(Object o, long offset,Object expected, Object x);`

    ä½†æ˜¯Unsafeç±»ä¸å¤Ÿä¼˜é›…ï¼ŒJavaåˆå°è£…äº†AtomicIntegerç­‰**åŸå­ç±»**æ–¹é¢æˆ‘ä»¬è¿›è¡ŒåŸå­æ“ä½œã€‚

    ![](https://i.loli.net/2021/04/27/v9PAlFethgzySkn.png)

    ---

15. ğŸ‘¨â€âš–ï¸ï¼šä½¿ç”¨CASå®ç°åŸå­æ“ä½œæœ‰å¯èƒ½å‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ

    ğŸ™‹â€â™‚ï¸ï¼š1ã€ABAé—®é¢˜ï¼Œå°±æ˜¯ä¸€ä¸ªå€¼åŸæ¥æ˜¯Aï¼Œå˜æˆäº†Bï¼Œåˆå˜æˆäº†Aï¼Œè¿™ä¸ªæ—¶å€™ä½¿ç”¨CASæ˜¯æ£€æŸ¥ä¸å‡ºé—®é¢˜çš„ï¼Œä½†æ˜¯å®é™…ä¸Šè¯¥å…±äº«å˜é‡å·²ç»è¢«æ›´æ–°äº†ä¸¤æ¬¡ã€‚è§£å†³æ–¹æ¡ˆæ˜¯ä¸ºæ¯ä¸ªå…±äº«å˜é‡åŠ ä¸Šç‰ˆæœ¬å·æˆ–è€…æ—¶é—´æˆ³ã€‚2ã€å¾ªç¯æ—¶é—´é•¿å¼€é”€è¾ƒå¤§ï¼ŒCASæ“ä½œå†…éƒ¨ä½¿ç”¨çš„æ˜¯æ­»å¾ªç¯ï¼Œå¦‚æœCASæ“ä½œé•¿æ—¶é—´ä¸æˆåŠŸï¼Œä¼šå ç”¨å¤§é‡çš„CPUèµ„æºã€‚è§£å†³æ–¹æ¡ˆæ˜¯JVMçš„pauseæŒ‡ä»¤ã€‚3ã€åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œï¼Œè€Œsynchronizedèƒ½ä¿è¯ä»£ç å—å†…çš„åŸå­æ€§ã€‚è§£å†³æ–¹æ¡ˆæ˜¯JDK1.5ä¹‹åæä¾›çš„AtomiceReferenceç±»ä¿è¯å¯¹è±¡çš„åŸå­æ€§ï¼Œå¯ä»¥æŠŠå¤šä¸ªå˜é‡æ”¾åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­è¿›è¡ŒCASæ“ä½œã€‚

    ---

16. ğŸ‘¨â€âš–ï¸ï¼šè®²ä¸€ä¸‹ä¹è§‚é”å’Œæ‚²è§‚é”

    ğŸ™‹â€â™‚ï¸ï¼šæ‚²è§‚é”å°±æ˜¯å¾ˆæ‚²è§‚ï¼Œè®¤ä¸ºæ¯æ¬¡è®¿é—®å…±äº«èµ„æºæ—¶éƒ½ä¼šå‘ç”Ÿå†²çªï¼Œæ‰€ä»¥å¿…é¡»å¯¹æ¯æ¬¡æ“ä½œåŠ é”ã€‚å¸¸è§çš„æ‚²è§‚é”æœ‰ï¼šå…³ç³»å‹æ•°æ®åº“çš„å…¨å±€é”ã€è¡¨é”ã€è¡Œé”ï¼›Javaçš„synchronizedå…³é”®å­—ã€‚æ¥ä¸‹æ¥è¯´ä¸€ä¸‹ä¹è§‚é”ï¼Œä¹è§‚é”åˆç§°æ— é”ï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒè®¤ä¸ºæ¯æ¬¡è®¿é—®å…±äº«èµ„æºéƒ½æ²¡æœ‰å†²çªï¼Œæ‰€ä»¥ä¸ä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°å…±äº«èµ„æºæ—¶ä¼šåˆ¤æ–­åœ¨æ­¤æœŸé—´æœ‰å’©æœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹è¿‡æ•°æ®ã€‚ä¹è§‚é”çš„å®ç°æœ‰CASå®ç°å’Œç‰ˆæœ¬å·æ§åˆ¶å®ç°ä¸¤ç§ã€‚

    ---

17. ğŸ‘¨â€âš–ï¸ï¼šä¹è§‚é”/æ‚²è§‚é”ã€è‡ªæ—‹é”/é€‚åº”æ€§è‡ªæ—‹é”ã€æ— é”/åå‘é”/è½»é‡çº§é”/é‡é‡çº§é”ã€å…¬å¹³é”/éå…¬å¹³é”ã€å¯é‡å…¥é”/éå¯é‡å…¥é”ã€å…±äº«é”/ç‹¬å é”

    ğŸ™‹â€â™‚ï¸ï¼š[ä¸å¯ä¸è¯´çš„Javaâ€œé”â€äº‹](https://tech.meituan.com/2018/11/15/java-lock.html)

    > æˆ‘çš„æ€»ç»“ï¼š
    >
    > ä¹è§‚é”å’Œéæ‚²è§‚é”ï¼š#14
    >
    > è‡ªæ—‹é”å’Œé€‚åº”æ€§è‡ªæ—‹é”ï¼šåªåœ¨å¤šå¤„ç†å™¨ä¸‹ä½¿ç”¨ã€‚è¯·æ±‚ä¸åˆ°é”çš„çº¿ç¨‹ä¸é˜»å¡ï¼Œè€Œæ˜¯è‡ªæ—‹ç­‰å¾…ï¼Œçœ‹çœ‹å…¶ä»–æŒæœ‰é”çš„çº¿ç¨‹æ˜¯å¦å¾ˆå¾ˆå¿«é‡Šæ”¾ã€‚å¦‚æœè‡ªæ—‹æ—¶é—´çŸ­ï¼Œå¯ä»¥å‡å°‘çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„è€—è´¹ï¼Œå¦‚æœè‡ªæ—‹æ—¶é—´è¿‡é•¿ï¼Œä¼šç™½ç™½æµªè´¹CPUçš„æ—¶é—´ã€‚è‡ªæ—‹é”å®ç°çš„åŸç†ä¹Ÿæ˜¯CASï¼ŒåŸå­ç±»çš„æ“ä½œç”¨åˆ°äº†è‡ªæ—‹é”(æ­»å¾ªç¯)ã€‚è‡³äºé€‚åº”æ€§è‡ªæ—‹é”å°±æ˜¯è‡ªæ—‹æ—¶é—´ä¸å†å›ºå®šï¼ŒåŠ¨æ€å˜åŒ–ã€‚
    >
    > æ— é”/åå‘é”/è½»é‡çº§é”/é‡é‡çº§é”ï¼šæ— é”å°±æ˜¯ä¹è§‚é”ã€‚synchronizedé»˜è®¤æ˜¯é‡é‡çº§é”ï¼Œè¦é¢‘ç¹è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚åå‘é”å’Œè½»é‡çº§é”ä¹Ÿæ˜¯é’ˆå¯¹synchronizedï¼Œå¯ä»¥å‡å°‘synchronizedè¿›è¡Œçº¿ç¨‹åŒæ­¥çš„è€—è´¹ã€‚
    >
    > å…¬å¹³é”å’Œéå…¬å¹³é”ï¼šå…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ï¼Œçº¿ç¨‹ç›´æ¥è¿›å…¥é˜Ÿåˆ—ä¸­æ’é˜Ÿï¼Œé˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªçº¿ç¨‹æ‰èƒ½è·å¾—é”ã€‚å…¬å¹³é”çš„ä¼˜ç‚¹æ˜¯ç­‰å¾…é”çš„çº¿ç¨‹ä¸ä¼šé¥¿æ­»ã€‚ç¼ºç‚¹æ˜¯æ•´ä½“ååæ•ˆç‡ç›¸å¯¹éå…¬å¹³é”è¦ä½ï¼Œç­‰å¾…é˜Ÿåˆ—ä¸­é™¤ç¬¬ä¸€ä¸ªçº¿ç¨‹ä»¥å¤–çš„æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šé˜»å¡ï¼ŒCPUå”¤é†’é˜»å¡çº¿ç¨‹çš„å¼€é”€æ¯”éå…¬å¹³é”å¤§ã€‚éå…¬å¹³é”æ˜¯å¤šä¸ªçº¿ç¨‹åŠ é”æ—¶ç›´æ¥å°è¯•è·å–é”ï¼Œè·å–ä¸åˆ°æ‰ä¼šåˆ°ç­‰å¾…é˜Ÿåˆ—çš„é˜Ÿå°¾ç­‰å¾…ã€‚å¦‚æœæ­¤æ—¶é”åˆšå¥½å¯ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å¯ä»¥æ— éœ€é˜»å¡ç›´æ¥è·å–åˆ°é”ï¼Œæ‰€ä»¥éå…¬å¹³é”æœ‰å¯èƒ½å‡ºç°åç”³è¯·é”çš„çº¿ç¨‹å…ˆè·å–é”çš„åœºæ™¯ã€‚éå…¬å¹³é”çš„ä¼˜ç‚¹æ˜¯å¯ä»¥å‡å°‘å”¤èµ·çº¿ç¨‹çš„å¼€é”€ï¼Œæ•´ä½“çš„ååæ•ˆç‡é«˜ï¼Œå› ä¸ºçº¿ç¨‹æœ‰å‡ ç‡ä¸é˜»å¡ç›´æ¥è·å¾—é”ï¼ŒCPUä¸å¿…å”¤é†’æ‰€æœ‰çº¿ç¨‹ã€‚ç¼ºç‚¹æ˜¯å¤„äºç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹å¯èƒ½ä¼šé¥¿æ­»ï¼Œæˆ–è€…ç­‰å¾ˆä¹…æ‰ä¼šè·å¾—é”ã€‚
    >
    > å¯é‡å…¥é”å’Œä¸å¯é‡å…¥é”ï¼šsynchronizedæ˜¯å¯é‡å…¥é”
    >
    > ```java
    > public class Widget {
    >     public synchronized void doSomething() {
    >         System.out.println("æ–¹æ³•1æ‰§è¡Œ...");
    >         doOthers();
    >     }
    > 
    >     public synchronized void doOthers() {
    >         System.out.println("æ–¹æ³•2æ‰§è¡Œ...");
    >     }
    > }
    > ```
    >
    > å¦‚æœä¸¤ä¸ªåŒæ­¥å—çš„é”ä¸€æ ·ï¼Œå¯å¤ç”¨çš„ä¸ºå¯é‡å…¥é”ï¼Œä¸å¯å¤ç”¨çš„ä¸ºä¸å¯é‡å…¥é”ï¼Œä¸å¯é‡å…¥é”ä¼šäº§ç”Ÿæ­»é”ã€‚

    ---

18. ğŸ‘¨â€âš–ï¸ï¼šä»€ä¹ˆæ˜¯LockSupport

    ğŸ™‹â€â™‚ï¸ï¼šLockSupportæ˜¯JUCçš„ä¸€ä¸ªå·¥å…·ç±»ï¼Œä½¿ç”¨å®ç°çº¿ç¨‹çš„é˜»å¡å’Œå”¤é†’ã€‚åœ¨é”å—å¤–ä¹Ÿèƒ½ç”¨ï¼Œå¦‚æœæˆ‘ä»¬åªæ˜¯æƒ³é˜»å¡/å”¤é†’ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸è€ƒè™‘é”é‚£äº›ä¸œè¥¿ï¼Œç”¨å®ƒå°±å¯¹äº†ã€‚AQSçš„åº•å±‚ä¹Ÿç”¨åˆ°äº†LockSupportï¼Œå®ƒçš„ä¸¤ä¸ªæ–¹æ³•æ˜¯parkå’Œunpackï¼Œåˆ†åˆ«å¯¹åº”é˜»å¡å’Œå”¤é†’ã€‚

    > LockSuppportçš„ä¼˜ç‚¹ï¼š
    >
    > ç›®å‰æˆ‘çŸ¥é“çš„ç”¨æ¥å®ç°çº¿ç¨‹é˜»å¡å’Œå”¤é†’çš„æ–¹å¼æœ‰ä¸‰ç§ï¼š
    >
    > - waitå’Œnotifyã€‚ç¼ºç‚¹æ˜¯åªèƒ½åœ¨synchronizedåŒæ­¥å—å†…ä½¿ç”¨ï¼Œè€Œä¸”ä¸èƒ½å…ˆnotifyå†waitï¼Œä¸€ä¸ªwaitå¿…å¯¹åº”ä¸€ä¸ªnotify
    > - Conditionçš„awaitå’Œsignalæ–¹æ³•ã€‚ç¼ºç‚¹åŒæ ·æ˜¯åªèƒ½åœ¨lockå’Œunlockå—å†…ä½¿ç”¨ï¼Œé¡ºåºä¹Ÿæœ‰è¦æ±‚
    > - å·¥å…·ç±»LockSupportçš„é™æ€æ–¹æ³•parkå’Œunpackï¼Œå®ƒçš„å®ç°æœºåˆ¶æ˜¯"è®¸å¯è¯"ï¼Œåœ¨é”å—å¤–ä¹Ÿèƒ½ç”¨ï¼Œé¡ºåºä¹Ÿæ²¡è¦æ±‚ã€‚

19. ğŸ‘¨â€âš–ï¸ï¼šè¯´ä¸€ä¸‹ä½ å¯¹AQSçš„ç†è§£

    ğŸ™‹â€â™‚ï¸ï¼šä¸€æ–‡è¯¦è§£JUCçš„åº•å±‚-[AQSè¯¦è§£.mdï¼Œè¿˜æ²¡æ•´ç†åˆ°åšå®¢])

20. ğŸ‘¨â€âš–ï¸ï¼šäº†è§£é˜»å¡é˜Ÿåˆ—å—ï¼Ÿè¯´è¯´å®ƒçš„ç”¨æ³•å’Œå…·ä½“å®ç°

    ğŸ™‹â€â™‚ï¸ï¼šé˜»å¡é˜Ÿåˆ—æ˜¯JDKæä¾›äº†ä¸€ä¸ªå·¥å…·ç±»BlockingQueue(æ¥å£)ï¼Œå®ƒæœ‰å››ä¸ªåŸºæœ¬çš„å®ç°ç±»ï¼Œæ¯ä¸ªå®ç°ç±»éƒ½æœ‰è‡ªå·±çš„åº”ç”¨åœºæ™¯ã€‚é˜»å¡é˜Ÿåˆ—äº§ç”Ÿçš„çµæ„Ÿæ¥è‡ªäºç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼Œä»¥å‰æˆ‘ä»¬å®ç°ç”Ÿäº§è€…æ¶ˆè´¹è€…ä¸€èˆ¬ä½¿ç”¨synchronized-wait-notifyæˆ–è€…Lock-awati-signalï¼Œå› ä¸ºéœ€è¦è®©å¤šä¸ªçº¿ç¨‹æ“ä½œå…±äº«å˜é‡ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“é€ æˆé‡å¤æ¶ˆè´¹å’Œæ­»é”çš„é—®é¢˜ï¼Œå°¤å…¶æ˜¯å¤šä¸ªç”Ÿäº§è€…å¤šä¸ªæ¶ˆè´¹è€…ã€‚

    è¿™ä¹ˆå®¹å™¨å‡ºé”™çš„äº‹æƒ…ï¼ŒJDKå°±ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªapiå°±æ˜¯é˜»å¡é˜Ÿåˆ—ï¼Œå…¶å®è¯´ç™½äº†å°±æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„æ™®é€šé˜Ÿåˆ—ã€‚

    - é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œä»é˜Ÿåˆ—ä¸­å–å…ƒç´ çš„çº¿ç¨‹ä¼šè¢«è‡ªåŠ¨é˜»å¡ï¼Œé˜Ÿåˆ—éç©ºæ—¶ä¼šè‡ªåŠ¨å”¤é†’é˜»å¡çš„è¿›ç¨‹ã€‚
    - é˜Ÿåˆ—æ»¡äº†æ—¶ï¼Œä»é˜Ÿåˆ—ä¸­æ·»å…ƒç´ çš„çº¿ç¨‹ä¼šè¢«è‡ªåŠ¨é˜»å¡ï¼Œç›´åˆ°å…ƒç´ è¢«æ¶ˆè´¹éç©ºæ‰ä¼šå”¤é†’é˜»å¡çš„è¿›ç¨‹ã€‚

    BlockingQueueæä¾›äº†å››ç»„å¢åˆ æŸ¥æ–¹æ³•æ¥å¸®åŠ©æˆ‘ä»¬æ“ä½œé˜Ÿåˆ—

    ![image-20210423215020731](https://i.loli.net/2021/04/27/miy1KeCcbTQG7FE.png)

    BlockingQueueçš„å®ç°ç±»æœ‰ï¼š

    - ArrayBlockingQueue    å¯¹æ ‡ArrayListï¼Œæœ‰ç•Œæ•°ç»„çš„é˜»å¡é˜Ÿåˆ—
    - LinkedBlockingQueue    å¯¹æ ‡LinkedListï¼Œæ— ç•Œé“¾è¡¨çš„é˜»å¡é˜Ÿåˆ—
    - DelayQueue   ä¸€ä¸ªæ²¡æœ‰å¤§å°é™åˆ¶çš„é˜Ÿåˆ—ï¼Œå› æ­¤å¾€é˜Ÿåˆ—ä¸­æ’å…¥æ•°æ®çš„æ“ä½œï¼ˆç”Ÿäº§è€…ï¼‰æ°¸è¿œä¸ä¼šè¢«é˜»å¡ï¼Œè€Œåªæœ‰è·å–æ•°æ®çš„æ“ä½œï¼ˆæ¶ˆè´¹è€…ï¼‰æ‰ä¼šè¢«é˜»å¡ï¼Œå¯ä»¥è®¾ç½®å»¶è¿Ÿæ—¶é—´
    - PriorityBlockingQueue    å…·æœ‰ä¼˜å…ˆçº§çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—
    - SynchronousQueue    åªèƒ½å­˜ä¸€ä¸ªå…ƒç´ çš„é˜»å¡é˜Ÿåˆ—

    é˜»å¡é˜Ÿåˆ—çš„åŸç†

    åŸºäºLocké”çš„å¤šæ¡ä»¶ï¼ˆConditionï¼‰é˜»å¡æ§åˆ¶ï¼Œé˜Ÿåˆ—+Lock+Conditionæ§åˆ¶ç”Ÿäº§å’Œæ¶ˆè´¹

    ---

21. ğŸ‘¨â€âš–ï¸ï¼šsynchronizedå’ŒLockçš„åŒºåˆ«

    ğŸ™‹â€â™‚ï¸

    - synchronizedæ˜¯å…³é”®å­—å±äºJVMå±‚é¢ï¼Œåº•å±‚é€šè¿‡monitoræ¥å®ç°é”ä¸è§£é”ã€‚Lockæ˜¯å…·ä½“ç±»å±äºapiå±‚é¢ã€‚
    - synchronizedä¸éœ€è¦ç”¨æˆ·å»æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œä»£ç å—æ‰§è¡Œå®Œä¼šè‡ªåŠ¨é‡Šæ”¾é”ã€‚Lockå±äºç”¨æˆ·æ‰‹åŠ¨é‡Šæ”¾é”ã€‚
    - Lockæä¾›äº†æ›´ä¸°å¯Œçš„apiï¼Œå¯ä»¥ä¸­æ–­çº¿ç¨‹çš„æ‰§è¡Œï¼Œçº¿ç¨‹ä¸ç”¨ä¸€ç›´é˜»å¡ç­‰å¾…ã€‚synchronizedä¸å¯ä¸­æ–­ï¼Œè¿›å»äº†å°±ä¸€å®šè¦è·å¾—é”ï¼Œéœ€è¦ä¸€ç›´é˜»å¡ç­‰å¾…ã€‚
    - synchronizedæ˜¯éå…¬å¹³é”ï¼ŒLockæä¾›äº†å…¬å¹³é”å’Œéå…¬å¹³é”(æ„é€ æ–¹æ³•ä¼ true/false)
    - synchroizedæ— æ³•çŸ¥é“çº¿ç¨‹æœ‰æ²¡æœ‰æˆåŠŸè·å¾—é”
    - synchronizedåªèƒ½éšå³å”¤é†’æŸä¸ªçº¿ç¨‹æˆ–è€…å…¨éƒ¨çº¿ç¨‹ï¼Œè€ŒLockç»‘å®šå¤šä¸ªæ¡ä»¶conditionï¼Œå¯ä»¥ç²¾ç¡®å”¤é†’æŸä¸ªçº¿ç¨‹ã€‚æ¯”å¦‚ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼ŒAæ‰§è¡Œå®ŒBæ‰§è¡Œæœ€åCæ‰§è¡Œï¼Œè¿™ä¸ªæ¨¡å‹ä½¿ç”¨synchronizedå®ç°å°±æ¯”è¾ƒå¤æ‚ï¼Œè€ŒLockå°±ååˆ†ç®€å•äº†ã€‚

    ---

22. ğŸ‘¨â€âš–ï¸ï¼šå¹¶å‘å®¹å™¨æœ‰å“ªäº›ï¼Ÿ

    ğŸ™‹â€â™‚ï¸ï¼š[å¹¶å‘é›†åˆå®¹å™¨ç®€ä»‹](https://redspider.gitbook.io/concurrent/di-san-pian-jdk-gong-ju-pian/15)

    ---

23. ğŸ‘¨â€âš–ï¸ï¼šCopyOnWriteæ€æƒ³å’ŒCopyOnWriteå®¹å™¨

    ğŸ™‹â€â™‚ï¸ï¼š[CopyOnWrite](https://redspider.gitbook.io/concurrent/di-san-pian-jdk-gong-ju-pian/16)

    ---

24. ğŸ‘¨â€âš–ï¸ï¼šäº†è§£semphoreï¼Ÿè¯´ä¸€è¯´å®ƒçš„ç”¨æ³•

    ğŸ™‹â€â™‚ï¸ï¼šsemhoreå³ä¿¡å·é‡ï¼Œåº•å±‚ä½¿ç”¨AQSå®ç°ã€‚å…·ä½“ä½œç”¨æ˜¯é™åˆ¶çº¿ç¨‹çš„æ•°é‡ï¼Œå®ƒæœ‰ä¸€ä¸ªpermitå˜é‡ï¼šè°ƒç”¨acquireï¼Œpremit-1ï¼›è°ƒç”¨releaseï¼Œpremit+1

    å¦‚æœpermit=0åœ¨è°ƒç”¨acquireï¼Œçº¿ç¨‹å°±ä¼šè¢«è‡ªåŠ¨é˜»å¡ï¼Œç›´åˆ°premit>0ã€‚è¿™ä¹ˆçœ‹æ¥ï¼Œå…¶å®å®ƒçš„å®ç°æœºåˆ¶å’ŒLockSupportçš„parkå’Œunparkæœ‰ç‚¹åƒï¼Œä½†æ˜¯ä½œç”¨åˆå’Œé˜»å¡é˜Ÿåˆ—æœ‰ç‚¹åƒ

    *Semaphoreæ¡ˆä¾‹(é™åˆ¶åŒæ—¶åªèƒ½æœ‰ä¸‰ä¸ªçº¿ç¨‹æ‰§è¡Œ)*

    ```java
    
    class ShareData{
        Semaphore semaphore;
        public ShareData(){
            // é™åˆ¶åŒæ—¶åªèƒ½ç”±ä¸‰ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œ
            this.semaphore=new Semaphore(3);
        }
        
        public void work(){
            try {
                semaphore.acquire();
                System.out.println(Thread.currentThread().getName()+"æ­£åœ¨æ‰§è¡Œï¼Œè¿˜å‰©"+semaphore.availablePermits()+"ä¸ªèµ„æº,"+
                        semaphore.getQueueLength()+"ä¸ªçº¿ç¨‹åœ¨ç­‰å¾…");
                semaphore.release();
                System.out.println(Thread.currentThread().getName()+"é‡Šæ”¾äº†èµ„æº");
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
    }
    
    public class semahoreTest {
        public static void main(String[] args) {
            ShareData shareData = new ShareData();
            for (int i = 0; i < 100; i++) {
                new Thread(()->{
                    shareData.work();
                },i+"").start();
            }
        }
    }
    
    ```

    **SemaphoreåŸç†ï¼š**

    Semaphoreå†…éƒ¨æœ‰ä¸€ä¸ªç»§æ‰¿äº†AQSçš„åŒæ­¥å™¨Syncï¼Œé‡å†™äº†`tryAcquireShared`æ–¹æ³•ã€‚åœ¨è¿™ä¸ªæ–¹æ³•é‡Œï¼Œä¼šå»å°è¯•è·å–èµ„æºã€‚

    å¦‚æœè·å–å¤±è´¥ï¼ˆæƒ³è¦çš„èµ„æºæ•°é‡å°äºç›®å‰å·²æœ‰çš„èµ„æºæ•°é‡ï¼‰ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ªè´Ÿæ•°ï¼ˆä»£è¡¨å°è¯•è·å–èµ„æºå¤±è´¥ï¼‰ã€‚ç„¶åå½“å‰çº¿ç¨‹å°±ä¼šè¿›å…¥AQSçš„ç­‰å¾…é˜Ÿåˆ—ã€‚

    å…¶å®å’ŒReentrantLockçš„å®ç°æœºåˆ¶åŸºæœ¬ä¸€æ ·ï¼Œåªä¸è¿‡å…±äº«èµ„æºå˜æˆäº†permitï¼Œè¿™ä¸ªpermitä¸å†æ˜¯1ï¼Œå¯ä»¥æ˜¯2 3 4ç­‰ç­‰ã€‚

    ---

25. ğŸ‘¨â€âš–ï¸ï¼šThreadLocaläº†è§£å—ï¼Ÿè®²ä¸€ä¸‹å®ƒçš„åŸç†

    ğŸ™‹â€â™‚ï¸ï¼šé€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åˆ›å»ºçš„å…¨å±€å˜é‡æ˜¯å¯ä»¥è¢«ä»»ä½•ä¸€ä¸ªçº¿ç¨‹è®¿é—®å¹¶ä¿®æ”¹çš„ã€‚å¦‚æœæƒ³å®ç°æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ä¸“å±æœ¬åœ°å˜é‡è¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿ JDK ä¸­æä¾›çš„ThreadLocalç±»æ­£æ˜¯ä¸ºäº†è§£å†³è¿™æ ·çš„é—®é¢˜ã€‚ThreadLocalç±»ä¸»è¦è§£å†³çš„å°±æ˜¯è®©æ¯ä¸ªçº¿ç¨‹ç»‘å®šè‡ªå·±çš„å€¼ï¼Œå¯ä»¥å°†ThreadLocalç±»å½¢è±¡çš„æ¯”å–»æˆå­˜æ”¾æ•°æ®çš„ç›’å­ï¼Œç›’å­ä¸­å¯ä»¥å­˜å‚¨æ¯ä¸ªçº¿ç¨‹çš„ç§æœ‰æ•°æ®ã€‚**å¦‚æœä½ åˆ›å»ºäº†ä¸€ä¸ªThreadLocalå˜é‡ï¼Œé‚£ä¹ˆè®¿é—®è¿™ä¸ªå˜é‡çš„æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰è¿™ä¸ªå˜é‡çš„æœ¬åœ°å‰¯æœ¬ï¼Œè¿™ä¹Ÿæ˜¯ThreadLocalå˜é‡åçš„ç”±æ¥ã€‚**ä»–ä»¬å¯ä»¥ä½¿ç”¨getå’Œsetæ–¹æ³•æ¥è·å–é»˜è®¤å€¼æˆ–å°†å…¶å€¼æ›´æ”¹ä¸ºå½“å‰çº¿ç¨‹æ‰€å­˜çš„å‰¯æœ¬çš„å€¼ï¼Œä»è€Œé¿å…äº†çº¿ç¨‹ä¸å®‰å…¨é—®é¢˜ã€‚

    åŸç†ï¼š

    æ¯ä¸ªçº¿ç¨‹å†…éƒ¨éƒ½ç»´æŠ¤äº†ä¸€ä¸ªThreadLocalMapç±»å‹çš„å˜é‡ï¼Œç”¨äºå­˜å‚¨å½“å‰çº¿ç¨‹æ‰€ä½¿ç”¨çš„ThreadLocalå˜é‡ã€‚é»˜è®¤æƒ…å†µä¸‹æ˜¯ nullï¼Œåªæœ‰å½“å‰çº¿ç¨‹è°ƒç”¨ThreadLocalç±»çš„setæˆ–getæ–¹æ³•æ—¶æ‰åˆ›å»ºå®ƒä»¬ã€‚

    è°ƒç”¨ThreadLocalçš„setæˆ–getæ–¹æ³•æ—¶ï¼Œå®é™…ä¸Šæ‰§è¡Œçš„æ˜¯å½“å‰çº¿ç¨‹ThreadLocalMapå˜é‡çš„getå’Œsetæ–¹æ³•ã€‚å› æ­¤ï¼ŒThreadLocalåªæ˜¯ä¸€ä¸ªå·¥å…·å£³ï¼ŒæŠŠå˜é‡å¡è¿›çº¿ç¨‹çš„å†…å­˜ä¸­ã€‚

    

    ![image-20210426224908562](https://i.loli.net/2021/04/27/yxDR1wtEWMchk65.png)

    ---

26. ğŸ‘¨â€âš–ï¸ï¼šThreadLocalçš„å†…å­˜æ³„éœ²

    ğŸ™‹â€â™‚ï¸

    ![image-20210426225752507](https://i.loli.net/2021/04/27/nCr25xwEUiXuSNI.png)

    ---

27. ğŸ‘¨â€âš–ï¸ï¼šCountDownLatchæ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆç”¨ï¼Ÿ

    ğŸ™‹â€â™‚ï¸ï¼šå‡è®¾æŸä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œä»»åŠ¡ä¹‹å‰ï¼Œéœ€è¦ç­‰å¾…å…¶å®ƒçº¿ç¨‹å®Œæˆä¸€äº›å‰ç½®ä»»åŠ¡ï¼Œå¿…é¡»ç­‰æ‰€æœ‰çš„å‰ç½®ä»»åŠ¡éƒ½å®Œæˆï¼Œæ‰èƒ½å¼€å§‹æ‰§è¡Œæœ¬çº¿ç¨‹çš„ä»»åŠ¡ã€‚ä»¥ä¸‹æ˜¯CountDownLatchçš„å¸¸ç”¨æ–¹æ³•

    ```JAVA
    // æ„é€ æ–¹æ³•ï¼š
    public CountDownLatch(int count)
    
    public void await() // ç­‰å¾…ï¼Œcount=0æ‰æ‰§è¡Œï¼Œ>0é˜»å¡æ­¤çº¿ç¨‹
    public boolean await(long timeout, TimeUnit unit) // è¶…æ—¶ç­‰å¾…
    public void countDown() // count - 1
    public long getCount() // è·å–å½“å‰è¿˜æœ‰å¤šå°‘count
    ```

    ---

28. ğŸ‘¨â€âš–ï¸ï¼šCyclicBarrieræ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆç”¨ï¼Ÿ

    ğŸ™‹â€â™‚ï¸ï¼šCyclicBarrirerä»åå­—ä¸Šæ¥ç†è§£æ˜¯â€œå¾ªç¯çš„å±éšœâ€çš„æ„æ€ã€‚å‰é¢æåˆ°äº†CountDownLatchä¸€æ—¦è®¡æ•°å€¼`count`è¢«é™ä¸º0åï¼Œå°±ä¸èƒ½å†é‡æ–°è®¾ç½®äº†ï¼Œå®ƒåªèƒ½èµ·ä¸€æ¬¡â€œå±éšœâ€çš„ä½œç”¨ã€‚è€ŒCyclicBarrieræ‹¥æœ‰CountDownLatchçš„æ‰€æœ‰åŠŸèƒ½ï¼Œè¿˜å¯ä»¥ä½¿ç”¨`reset()`æ–¹æ³•é‡ç½®å±éšœã€‚

    ---

### å‚è€ƒ




â€‹    

â€‹    